<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>3D Birthday Cake ðŸŽ‚</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
    margin:0;
    background:radial-gradient(circle,#1a1a2e,#000);
    color:white;
    text-align:center;
    font-family:Arial, sans-serif;
    overflow:hidden;
}
.page{display:none;padding:20px;}
.page.active{display:block}

input,button{
    padding:12px;
    width:90%;
    max-width:320px;
    margin:10px auto;
    border:none;
    border-radius:6px;
    font-size:16px;
    display:block;
}
button{background:#ff4081;color:white;}

#scene{width:100%;height:60vh;}

#successText{
    display:none;
    font-size:24px;
    color:#00ffcc;
    animation: glow 1s infinite alternate;
}
@keyframes glow{
    from{text-shadow:0 0 10px #00ffcc;}
    to{text-shadow:0 0 25px #00ffff;}
}
</style>
</head>
<body>

<div class="page active" id="page1">
    <h2>ðŸŽ‚ Birthday Cake ðŸŽ‚</h2>
    <input id="userName" placeholder="Birthday Person Name">
    <input id="dob" placeholder="DOB (DD-MM-YYYY)">
    <input id="sender" placeholder="Sender Name">
    <button onclick="startCake()">Reveal Cake ðŸŽ‰</button>
    <h3 id="ageShow"></h3>
</div>

<div class="page" id="page2">
    <h2>Tap Candles to Blow ðŸŽ‚</h2>
    <div id="scene"></div>
    <button id="cutCakeBtn" style="display:none" onclick="cutCake()">ðŸ”ª Cut the Cake</button>
    <h2 id="successText">ðŸŽ‰ Cake Cut Successfully! ðŸŽ‰</h2>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/loaders/FontLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/geometries/TextGeometry.js"></script>

<script>
let scene,camera,renderer,cakeGroup,knife;
let age=0,totalCandles=0,blownCandles=0,cakeCut=false;

const dob=document.getElementById("dob");
const ageShow=document.getElementById("ageShow");

dob.addEventListener("input",()=>{
 let p=dob.value.split("-");
 if(p.length!==3) return;
 let b=new Date(p[2],p[1]-1,p[0]);
 let t=new Date();
 age=t.getFullYear()-b.getFullYear();
 if(t.getMonth()<b.getMonth() || (t.getMonth()==b.getMonth() && t.getDate()<b.getDate())) age--;
 ageShow.innerText = age>0 ? "Age: "+age : "";
});

function showPage(n){
 document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
 document.getElementById("page"+n).classList.add("active");
}

function startCake(){
 if(age<=0){ alert("Enter valid DOB"); return; }
 showPage(2);
 init3D();
}

function init3D(){
 scene=new THREE.Scene();
 camera=new THREE.PerspectiveCamera(50,window.innerWidth/(window.innerHeight*0.6),0.1,1000);
 camera.position.set(0,6,18);

 renderer=new THREE.WebGLRenderer({alpha:true,antialias:true});
 renderer.setSize(window.innerWidth,window.innerHeight*0.6);
 document.getElementById("scene").appendChild(renderer.domElement);

 scene.add(new THREE.AmbientLight(0xffffff,0.8));
 let light=new THREE.PointLight(0xffccaa,2);
 light.position.set(5,10,5);
 scene.add(light);

 cakeGroup=new THREE.Group();
 cakeGroup.scale.set(0.15,0.15,0.15);
 scene.add(cakeGroup);

 let texture=new THREE.TextureLoader().load("cake.jpg");
 let cakeMat=new THREE.MeshStandardMaterial({map:texture});

 let bottom=new THREE.Mesh(new THREE.CylinderGeometry(5,5,3,64),cakeMat);
 cakeGroup.add(bottom);

 let top=new THREE.Mesh(new THREE.CylinderGeometry(3.5,3.5,2.5,64),cakeMat);
 top.position.y=3;
 cakeGroup.add(top);

 totalCandles=Math.min(age,10);
 blownCandles=0;

 for(let i=0;i<totalCandles;i++){
  let candle=new THREE.Mesh(
   new THREE.CylinderGeometry(0.18,0.18,1.2,16),
   new THREE.MeshStandardMaterial({color:0xffffff})
  );
  let a=i/totalCandles*Math.PI*2;
  candle.position.set(Math.cos(a)*2.2,4.2,Math.sin(a)*2.2);

  let flame=new THREE.Mesh(
   new THREE.ConeGeometry(0.25,0.8,16),
   new THREE.MeshStandardMaterial({
    color:0xffaa00,
    emissive:0xff6600,
    emissiveIntensity:1.5
   })
  );
  flame.position.y=0.9;
  flame.rotation.x=Math.PI;
  candle.userData.flame=flame;
  candle.add(flame);
  cakeGroup.add(candle);
 }

 // ðŸ”¤ NAME ON CAKE CREAM (3D)
 new THREE.FontLoader().load(
  "https://threejs.org/examples/fonts/helvetiker_bold.typeface.json",
  font=>{
   let geo=new THREE.TextGeometry(
    document.getElementById("userName").value,
    {
     font:font,
     size:1.2,
     height:0.35,
     bevelEnabled:true,
     bevelThickness:0.08,
     bevelSize:0.05,
     bevelSegments:5
    }
   );
   geo.center();
   let mat=new THREE.MeshStandardMaterial({
    color:0xfff1b5,
    emissive:0xffe066,
    emissiveIntensity:0.4,
    roughness:0.2
   });
   let text=new THREE.Mesh(geo,mat);
   text.position.set(0,4.4,0);
   text.rotation.x=-Math.PI/2.05;
   cakeGroup.add(text);
  }
 );

 // ðŸ”ª Knife
 knife=new THREE.Mesh(
  new THREE.BoxGeometry(0.2,6,1),
  new THREE.MeshStandardMaterial({color:0xcccccc})
 );
 knife.position.set(0,10,0);
 knife.visible=false;
 scene.add(knife);

 renderer.domElement.addEventListener("click",blowCandle);
 animate();
}

function blowCandle(e){
 let mouse=new THREE.Vector2(
  (e.clientX/window.innerWidth)*2-1,
  -(e.clientY/(window.innerHeight*0.6))*2+1
 );
 let ray=new THREE.Raycaster();
 ray.setFromCamera(mouse,camera);
 let hit=ray.intersectObjects(cakeGroup.children,true);
 hit.forEach(h=>{
  if(h.object.userData.flame && h.object.userData.flame.visible){
   h.object.userData.flame.visible=false;
   blownCandles++;
  }
 });
 if(blownCandles===totalCandles){
  document.getElementById("cutCakeBtn").style.display="block";
 }
}

function cutCake(){
 if(cakeCut) return;
 cakeCut=true;
 knife.visible=true;
 document.getElementById("successText").style.display="block";
}

function animate(){
 requestAnimationFrame(animate);

 if(cakeCut){
  knife.position.y-=0.1;
  cakeGroup.children.forEach(o=>{
   if(o.geometry && o.geometry.type.includes("Cylinder")){
    o.position.x+=o.position.x>=0?0.02:-0.02;
   }
  });
 }

 renderer.render(scene,camera);
}
</script>
</body>
</html>
